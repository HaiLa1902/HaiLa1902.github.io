<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡¯æ ¼å°”è¿åŠ¨æ¯æ—¥è®­ç»ƒ</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
            color: #333;
        }
        .trainer-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 15px;
        }
        p {
            margin-bottom: 15px;
            color: #555;
        }
        #status, #timer-display {
            font-size: 1.8em;
            font-weight: bold;
            margin: 20px 0;
            min-height: 50px; /* Prevent layout shifts */
        }
        #status {
             color: #d9534f; /* Red for contract */
        }
        #timer-display {
             color: #5cb85c; /* Green for timer */
        }
        #set-info {
            font-size: 1.1em;
            color: #777;
            margin-bottom: 25px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .instructions {
            text-align: left;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 0.95em;
        }
         .instructions ul {
             padding-left: 20px;
             margin-top: 5px;
         }
    </style>
</head>
<body>

<div class="trainer-container">
    <h1>å‡¯æ ¼å°”è¿åŠ¨åŠ©æ‰‹</h1>

    <div class="instructions">
        <strong>è®­ç»ƒå‰å‡†å¤‡ï¼š</strong>
        <ul>
            <li>ç¡®ä¿å·²æ’ç©ºè†€èƒ±ã€‚</li>
            <li>æ‰¾ä¸€ä¸ªèˆ’é€‚çš„ä½ç½®ï¼ˆå»ºè®®åˆå­¦è€…èººä¸‹ï¼‰ã€‚</li>
            <li>æ”¾æ¾è…¹éƒ¨ã€è‡€éƒ¨å’Œå¤§è…¿è‚Œè‚‰ã€‚</li>
            <li>è®°ä½åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒæ­£å¸¸å‘¼å¸ã€‚</li>
        </ul>
        <strong>ä»Šæ—¥è®¡åˆ’ï¼š</strong> 3 ç»„ï¼Œæ¯ç»„ 10 æ¬¡ã€‚æ¯æ¬¡æ”¶ç´§ 5 ç§’ï¼Œæ”¾æ¾ 5 ç§’ã€‚
    </div>

    <div id="status">å‡†å¤‡å¼€å§‹</div>
    <div id="timer-display">--</div>
    <div id="set-info">ç»„åˆ«: 0 / 3 | æ¬¡æ•°: 0 / 10</div>

    <button id="start-button">å¼€å§‹è®­ç»ƒ</button>
</div>

<script>
    const statusDisplay = document.getElementById('status');
    const timerDisplay = document.getElementById('timer-display');
    const setInfoDisplay = document.getElementById('set-info');
    const startButton = document.getElementById('start-button');

    // --- å¯é…ç½®çš„è®­ç»ƒå‚æ•° ---
    const totalSets = 3;        // æ€»å…±ç»„æ•°
    const repsPerSet = 10;       // æ¯ç»„æ¬¡æ•°
    const contractTime = 5;     // æ”¶ç´§ä¿æŒæ—¶é—´ï¼ˆç§’ï¼‰
    const relaxTime = 5;        // æ”¾æ¾æ—¶é—´ï¼ˆç§’ï¼‰
    const prepTime = 3;         // æ¯æ¬¡åŠ¨ä½œå‰çš„å‡†å¤‡æ—¶é—´ï¼ˆç§’ï¼‰
    // ------------------------

    let currentSet = 0;
    let currentRep = 0;
    let timerInterval = null;
    let state = 'idle'; // idle, prepping, contracting, relaxing, finished
    let countdown = 0;

    // --- è¯­éŸ³åˆæˆåŠŸèƒ½ ---
    const synth = window.speechSynthesis;
    let voiceEnabled = true; // å¯ä»¥è®¾ç½®ä¸º false æ¥ç¦ç”¨è¯­éŸ³

    function speak(text) {
        if (!voiceEnabled || !synth) {
            console.log("è¯­éŸ³å·²ç¦ç”¨æˆ–æµè§ˆå™¨ä¸æ”¯æŒã€‚");
            return;
        }
        // æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¯´è¯ï¼Œå¦‚æœæ˜¯ï¼Œå…ˆå–æ¶ˆ
        if (synth.speaking) {
            console.log('SpeechSynthesisUtterance: æ­£åœ¨è¯´è¯ï¼Œå–æ¶ˆä¹‹å‰çš„...');
           // synth.cancel(); // æœ‰æ—¶ç«‹å³å–æ¶ˆå¹¶è¯´æ–°çš„ä¼šå¯¼è‡´é—®é¢˜ï¼Œæ ¹æ®éœ€è¦å¯ç”¨
        }

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-CN'; // è®¾ç½®è¯­è¨€ä¸ºä¸­æ–‡
        utterance.rate = 1.0;     // è¯­é€Ÿ
        utterance.pitch = 1.0;    // éŸ³è°ƒ

        utterance.onerror = function(event) {
            console.error('SpeechSynthesisUtterance.onerror', event);
             // å‘ç”Ÿé”™è¯¯æ—¶å°è¯•ç¦ç”¨è¯­éŸ³ï¼Œé¿å…åç»­è¿ç»­æŠ¥é”™
            // voiceEnabled = false;
        };

        // ä½¿ç”¨ setTimeout ç¨å¾®å»¶è¿Ÿï¼Œæœ‰æ—¶å¯ä»¥è§£å†³å¿«é€Ÿè¿ç»­è°ƒç”¨é—®é¢˜
        // setTimeout(() => {
             synth.speak(utterance);
        // }, 50); // å»¶è¿Ÿ 50ms
    }
    // --------------------

    function updateDisplay() {
        setInfoDisplay.textContent = `ç»„åˆ«: ${currentSet} / ${totalSets} | æ¬¡æ•°: ${currentRep} / ${repsPerSet}`;
        timerDisplay.textContent = countdown > 0 ? countdown + ' ç§’' : '--';

        switch(state) {
            case 'idle':
                statusDisplay.textContent = 'å‡†å¤‡å¼€å§‹';
                statusDisplay.style.color = '#555';
                break;
            case 'prepping':
                 statusDisplay.textContent = 'å‡†å¤‡æ”¶ç´§...';
                 statusDisplay.style.color = '#ffc107'; // Yellow
                 break;
            case 'contracting':
                statusDisplay.textContent = 'æ”¶ ç´§';
                statusDisplay.style.color = '#d9534f'; // Red
                break;
            case 'relaxing':
                statusDisplay.textContent = 'æ”¾ æ¾';
                statusDisplay.style.color = '#5cb85c'; // Green
                break;
            case 'finished':
                statusDisplay.textContent = 'è®­ç»ƒå®Œæˆï¼ğŸ‰';
                statusDisplay.style.color = '#007bff'; // Blue
                timerDisplay.textContent = '--';
                break;
        }
    }

    function runTimer() {
        clearInterval(timerInterval); // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨

        timerInterval = setInterval(() => {
            countdown--;
            updateDisplay();

            if (countdown <= 0) {
                clearInterval(timerInterval);
                advanceState();
            }
        }, 1000);
    }

    function advanceState() {
        if (state === 'prepping') {
            state = 'contracting';
            countdown = contractTime;
            speak("æ”¶ç´§"); // è¯­éŸ³æç¤º
            updateDisplay();
            runTimer();
        } else if (state === 'contracting') {
            state = 'relaxing';
            countdown = relaxTime;
            speak("æ”¾æ¾"); // è¯­éŸ³æç¤º
            updateDisplay();
            runTimer();
        } else if (state === 'relaxing') {
            currentRep++;
            if (currentRep >= repsPerSet) {
                currentSet++;
                if (currentSet >= totalSets) {
                    // å…¨éƒ¨å®Œæˆ
                    state = 'finished';
                    speak("è®­ç»ƒå®Œæˆï¼å¾ˆæ£’ï¼");
                    updateDisplay();
                    startButton.disabled = false;
                    startButton.textContent = 'é‡æ–°å¼€å§‹';
                } else {
                    // è¿›å…¥ä¸‹ä¸€ç»„
                    currentRep = 0;
                    state = 'prepping'; // å‡†å¤‡ä¸‹ä¸€ç»„çš„ç¬¬ä¸€æ¬¡
                    countdown = prepTime;
                    speak(`ç¬¬ ${currentSet + 1} ç»„ï¼Œå‡†å¤‡`);
                    updateDisplay();
                    runTimer();
                }
            } else {
                // è¿›å…¥ä¸‹ä¸€æ¬¡é‡å¤
                state = 'prepping'; // å‡†å¤‡ä¸‹ä¸€æ¬¡æ”¶ç´§
                countdown = prepTime;
                speak("å‡†å¤‡");
                updateDisplay();
                runTimer();
            }
        }
    }

    function startWorkout() {
        // å°è¯•åœ¨ç”¨æˆ·äº¤äº’åæ’­æ”¾ä¸€ä¸ªæ— å£°æˆ–ç®€çŸ­çš„è¯­éŸ³ï¼Œä»¥æ¿€æ´»è¯­éŸ³æƒé™
        // speak(""); // æœ‰äº›æµè§ˆå™¨éœ€è¦è¿™æ ·

        startButton.disabled = true;
        startButton.textContent = 'è®­ç»ƒä¸­...';
        currentSet = 0;
        currentRep = 0;
        state = 'prepping'; // ä»å‡†å¤‡çŠ¶æ€å¼€å§‹ç¬¬ä¸€ç»„ç¬¬ä¸€æ¬¡
        countdown = prepTime;

        speak(`è®­ç»ƒå¼€å§‹ï¼Œç¬¬ 1 ç»„ï¼Œå‡†å¤‡`);
        updateDisplay();
        runTimer();
    }

    // åˆå§‹åŒ–æ˜¾ç¤º
    updateDisplay();

    startButton.addEventListener('click', startWorkout);

    // é¡µé¢åŠ è½½æ—¶å°è¯•é—®å€™ï¼Œä¹Ÿå¯èƒ½æœ‰åŠ©äºæ¿€æ´»è¯­éŸ³
    // window.addEventListener('load', () => speak("å‡¯æ ¼å°”è¿åŠ¨åŠ©æ‰‹å·²å‡†å¤‡å¥½"));

</script>

</body>
</html>
